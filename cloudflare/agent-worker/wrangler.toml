name = "defrag-agent"
main = "src/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# Account settings (set via environment or wrangler login)
# account_id = ""

[observability]
enabled = true

[vars]
ENVIRONMENT = "development"
BACKEND_URL = "https://api.defrag.app"

# Durable Objects
[[durable_objects.bindings]]
name = "USER_AGENT_DO"
class_name = "UserAgentDO"

[[migrations]]
tag = "v1"
new_classes = ["UserAgentDO"]

# D1 Database (commented out for local dev until provisioned)
# [[d1_databases]]
# binding = "AGENT_DB"
# database_name = "defrag-agent-db"
# database_id = "" # Set after creating: wrangler d1 create defrag-agent-db

# R2 Bucket for artifacts
[[r2_buckets]]
binding = "AGENT_R2"
bucket_name = "defrag-agent-artifacts"

# Vectorize Index for semantic memory
[[vectorize]]
binding = "AGENT_MEM_INDEX"
index_name = "defrag-memory-index"

# Workers AI binding
[ai]
binding = "AI"

# Secrets (set via wrangler secret put)
# BACKEND_HMAC_SECRET - for signing tool requests
# JWT_PUBLIC_KEY - for verifying user tokens

# Production overrides
[env.production]
vars = { ENVIRONMENT = "production", BACKEND_URL = "https://api.defrag.app" }

# Development overrides
[env.development]
vars = { ENVIRONMENT = "development", BACKEND_URL = "http://localhost:8000" }
