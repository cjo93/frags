name = "defrag-agent"
main = "src/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# Account settings (set via environment or wrangler login)
account_id = "01bd220f56d573a14428d86f654e49eb"

[observability]
enabled = true

[vars]
ENVIRONMENT = "development"
BACKEND_URL = "https://api.defrag.app"

# Durable Objects
[[durable_objects.bindings]]
name = "USER_AGENT_DO"
class_name = "UserAgentDO"

[[migrations]]
tag = "v1"
new_classes = ["UserAgentDO"]

# D1 Database
[[d1_databases]]
binding = "AGENT_DB"
database_name = "defrag-agent-db"
database_id = "956fd4b3-e16c-41f6-a658-07b5e97a50b4"

# Workers AI binding
[ai]
binding = "AI"

# Secrets (set via wrangler secret put)
# BACKEND_HMAC_SECRET - for signing tool requests
# JWT_PUBLIC_KEY - for verifying user tokens

# Production overrides
[env.production]
vars = { ENVIRONMENT = "production", BACKEND_URL = "https://api.defrag.app" }

[[env.production.r2_buckets]]
binding = "AGENT_R2"
bucket_name = "defrag-agent-artifacts"

[[env.production.vectorize]]
binding = "AGENT_MEM_INDEX"
index_name = "defrag-memory-index"

# Development overrides
[env.development]
vars = { ENVIRONMENT = "development", BACKEND_URL = "http://localhost:8000" }
